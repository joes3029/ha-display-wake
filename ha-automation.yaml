# Home Assistant Automations for ha-display-wake
#
# ── Configuration ──────────────────────────────────────────────────────────────
#
# 1. Replace every instance of "binary_sensor.office_pir_motion" with your
#    sensor's entity ID. Find yours in HA: Settings → Devices & Services → Entities.
#
# 2. Replace "office" in the MQTT topics and aliases with your room name.
#    The room name must match what you configure in the client scripts.
#
# 3. The wake interval (minutes: "/10") should be SHORTER than the shortest
#    screen timeout across your PCs. For 20-minute timeouts, 10 minutes works.
#
# ── Installation ───────────────────────────────────────────────────────────────
#
# OPTION A — Paste into automations.yaml:
#   Append the contents of this file to your automations.yaml and restart HA.
#
# OPTION B — Use the HA UI:
#   For each automation below:
#   1. Go to Settings → Automations → Create Automation → Create new automation
#   2. Click the three-dot menu (⋮) top right → Edit in YAML
#   3. Paste the automation (everything from "alias:" to just before the next
#      "---" separator or end of file). Do NOT include the leading "- ".
#   4. Click Save.
#   Repeat for all three automations.
#
# ───────────────────────────────────────────────────────────────────────────────

# ── 1. Wake on room entry (vacant → occupied transition) ─────────────────────

- alias: "ha-display-wake: Office entry wake"
  description: >
    Publishes a wake command when someone enters the office
    (sensor transitions from off to on).
  trigger:
    - platform: state
      entity_id: binary_sensor.office_pir_motion
      from: "off"
      to: "on"
  action:
    - service: mqtt.publish
      data:
        topic: "ha-display-wake/office/command"
        payload: "wake"
        qos: 0
    - service: mqtt.publish
      data:
        topic: "ha-display-wake/office/state"
        payload: "occupied"
        retain: true

# ── 2. Periodic wake while room remains occupied ─────────────────────────────
# Keeps screens alive during sustained presence (reading, calls, etc.)

- alias: "ha-display-wake: Office sustained wake"
  description: >
    Periodically publishes wake while the office remains occupied,
    preventing screens from timing out during presence.
  trigger:
    - platform: time_pattern
      minutes: "/10"
  condition:
    - condition: state
      entity_id: binary_sensor.office_pir_motion
      state: "on"
  action:
    - service: mqtt.publish
      data:
        topic: "ha-display-wake/office/command"
        payload: "wake"
        qos: 0

# ── 3. Publish vacant state when presence ends ───────────────────────────────
# Informational — for dashboards and future features (e.g. auto-lock).

- alias: "ha-display-wake: Office vacant"
  description: >
    Publishes vacant state when the office sensor goes off.
  trigger:
    - platform: state
      entity_id: binary_sensor.office_pir_motion
      to: "off"
  action:
    - service: mqtt.publish
      data:
        topic: "ha-display-wake/office/state"
        payload: "vacant"
        retain: true
