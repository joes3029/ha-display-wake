# Home Assistant Automations for ha-display-wake
#
# Add via the HA UI (Settings → Automations → Create → Edit in YAML)
# or append to your automations.yaml file.
#
# ── Configuration ──────────────────────────────────────────────────────────────
#
# 1. Set your sensor entity ID here (once) — it's referenced by all three
#    automations via the YAML anchor &sensor / *sensor:
#
#      entity_id: &sensor binary_sensor.office_pir_motion
#                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
#                         Replace this with your sensor's entity ID.
#                         Find it in HA: Settings → Devices & Services → Entities.
#
# 2. Replace "office" in the MQTT topic strings and automation aliases with
#    your room name. The room name must match what you configure in the client
#    scripts.
#
# The wake interval (minutes: "/10") should be SHORTER than the shortest screen
# timeout across your PCs. For 20-minute timeouts, 10 minutes is sensible.
# ───────────────────────────────────────────────────────────────────────────────

# ── 1. Wake on room entry (vacant → occupied transition) ─────────────────────

- alias: "ha-display-wake: Office entry wake"
  description: >
    Publishes a wake command when someone enters the office
    (sensor transitions from off to on).
  trigger:
    - platform: state
      entity_id: &sensor binary_sensor.bench_lights_pir_sensor   # ← SET YOUR SENSOR HERE
      from: "off"
      to: "on"
  action:
    - service: mqtt.publish
      data:
        topic: "ha-display-wake/office/command"
        payload: "wake"
        qos: 0
    - service: mqtt.publish
      data:
        topic: "ha-display-wake/office/state"
        payload: "occupied"
        retain: true

# ── 2. Periodic wake while room remains occupied ─────────────────────────────
# Keeps screens alive during sustained presence (reading, calls, etc.)

- alias: "ha-display-wake: Office sustained wake"
  description: >
    Periodically publishes wake while the office remains occupied,
    preventing screens from timing out during presence.
  trigger:
    - platform: time_pattern
      minutes: "/10"
  condition:
    - condition: state
      entity_id: *sensor
      state: "on"
  action:
    - service: mqtt.publish
      data:
        topic: "ha-display-wake/office/command"
        payload: "wake"
        qos: 0

# ── 3. Publish vacant state when presence ends ───────────────────────────────
# Informational — for dashboards and future features (e.g. auto-lock).

- alias: "ha-display-wake: Office vacant"
  description: >
    Publishes vacant state when the office sensor goes off.
  trigger:
    - platform: state
      entity_id: *sensor
      to: "off"
  action:
    - service: mqtt.publish
      data:
        topic: "ha-display-wake/office/state"
        payload: "vacant"
        retain: true
