# Home Assistant Automations for ha-display-wake
#
# Add via the HA UI (Settings → Automations → Create → Edit in YAML)
# or append to your automations.yaml file.
#
# ── Configuration ──────────────────────────────────────────────────────────────
# Replace these values:
#   - binary_sensor.office_pir_motion  → your sensor entity ID
#   - "office"                         → your room name (must match client config)
#
# The wake interval (minutes: "/10") should be SHORTER than the shortest screen
# timeout across your PCs. For 20-minute timeouts, 10 minutes is sensible.
# ───────────────────────────────────────────────────────────────────────────────

# ── 1. Wake on room entry (vacant → occupied transition) ─────────────────────

- alias: "ha-display-wake: Office entry wake"
  description: >
    Publishes a wake command when someone enters the office
    (sensor transitions from off to on).
  trigger:
    - platform: state
      entity_id: binary_sensor.office_pir_motion
      from: "off"
      to: "on"
  action:
    - service: mqtt.publish
      data:
        topic: "ha-display-wake/office/command"
        payload: "wake"
        qos: 0
    - service: mqtt.publish
      data:
        topic: "ha-display-wake/office/state"
        payload: "occupied"
        retain: true

# ── 2. Periodic wake while room remains occupied ─────────────────────────────
# Keeps screens alive during sustained presence (reading, calls, etc.)

- alias: "ha-display-wake: Office sustained wake"
  description: >
    Periodically publishes wake while the office remains occupied,
    preventing screens from timing out during presence.
  trigger:
    - platform: time_pattern
      minutes: "/10"
  condition:
    - condition: state
      entity_id: binary_sensor.office_pir_motion
      state: "on"
  action:
    - service: mqtt.publish
      data:
        topic: "ha-display-wake/office/command"
        payload: "wake"
        qos: 0

# ── 3. Publish vacant state when presence ends ───────────────────────────────
# Informational — for dashboards and future features (e.g. auto-lock).

- alias: "ha-display-wake: Office vacant"
  description: >
    Publishes vacant state when the office sensor goes off.
  trigger:
    - platform: state
      entity_id: binary_sensor.office_pir_motion
      to: "off"
  action:
    - service: mqtt.publish
      data:
        topic: "ha-display-wake/office/state"
        payload: "vacant"
        retain: true
